/*! bookdrift 2015-07-11 author:Mickey */
var AddBookForm=React.createClass({displayName:"AddBookForm",submit:function(a){a.preventDefault(),$.ajax({url:"/book/add/by/"+localStorage.userId+"/",type:"POST",data:new FormData(a.target),contentType:!1,processData:!1,success:function(a){"200"==a&&$("#addBookForm input").val("")}})},render:function(){return React.createElement("form",{className:"form-horizontal",onSubmit:this.submit,id:"addBookForm"},React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputName",className:"col-sm-2 control-label"},"书名"),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{type:"text",className:"form-control",id:"inputName",ref:"name",name:"name"}))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputAuthor",className:"col-sm-2 control-label"},"作者"),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{type:"text",className:"form-control",id:"inputAuthor",ref:"author",name:"author"}))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputPicture",className:"col-sm-2 control-label"},"封面"),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{type:"file",className:"form-control",id:"inputPicture",ref:"picture",name:"picture"}))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputKind",className:"col-sm-2 control-label"},"类型"),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{type:"text",className:"form-control",id:"inputKind",ref:"kind",name:"kind"}))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputDescription",className:"col-sm-2 control-label"},"简介"),React.createElement("div",{className:"col-sm-10"},"//",React.createElement("input",{type:"text",className:"form-control",id:"inputDescription",ref:"description",name:"description"}),React.createElement("textarea",{className:"form-control",id:"inputDescription",ref:"description",name:"description"}))),React.createElement("div",{className:"form-group"},React.createElement("div",{className:"col-sm-10 col-sm-offset-2"},React.createElement("input",{type:"submit",className:"form-control",value:"提交"}))))}}),AddCommentForm=React.createClass({displayName:"AddCommentForm",setMark:function(a){var b=a.target.id,c=$("#"+b);c.prevAll("span").removeClass("glyphicon-star-empty"),c.nextAll("span").removeClass("glyphicon-star"),c.removeClass("glyphicon-star-empty"),c.addClass("glyphicon-star"),c.prevAll("span").addClass("glyphicon-star"),c.nextAll("span").addClass("glyphicon-star-empty")},addComment:function(){var a=$(".glyphicon-star").length,b=React.findDOMNode(this.refs.content).value,c={mark:a,content:b},d=this.props.book.pk,e=localStorage.userId,f="/book/"+d+"/comment/add/by/"+e+"/";$.post(f,c,function(a){"200"!=a&&alert("添加评论失败")})},render:function(){return React.createElement("div",{className:"form-horizontal",id:"addCommentForm"},React.createElement("h4",null,"添加评论："),React.createElement("div",{className:"form-group",style:{marginLeft:20}},React.createElement("label",null,"评分："),React.createElement("span",{onClick:this.setMark,className:"glyphicon glyphicon-star-empty",id:"mark1"}),React.createElement("span",{onClick:this.setMark,className:"glyphicon glyphicon-star-empty",id:"mark2"}),React.createElement("span",{onClick:this.setMark,className:"glyphicon glyphicon-star-empty",id:"mark3"}),React.createElement("span",{onClick:this.setMark,className:"glyphicon glyphicon-star-empty",id:"mark4"}),React.createElement("span",{onClick:this.setMark,className:"glyphicon glyphicon-star-empty",id:"mark5"})),React.createElement("div",{className:"form-group",style:{marginLeft:20}},React.createElement("label",{htmlFor:"inputComment"},"内容："),React.createElement("input",{type:"text",className:"form-control",id:"inputComment",ref:"content",name:"content",placeholder:"写下你的评论吧"})),React.createElement("div",{className:"form-group",style:{marginLeft:20}},React.createElement("button",{className:"btn",onClick:this.addComment},"评论")))}}),ApplyButton=React.createClass({displayName:"ApplyButton",addApply:function(){var a=localStorage.userId,b=this.props.book.pk,c="/drift/"+b+"/apply/by/"+a+"/";$.get(c,function(a){"200"==a&&alert("申请成功")})},render:function(){return React.createElement("a",{href:"#",className:"btn btn-primary",role:"button",onClick:this.addApply},"想要")}}),ApplyHistory=React.createClass({displayName:"ApplyHistory",getInitialState:function(){return{users:[]}},render:function(){return React.createElement("div",null)}}),Book=React.createClass({displayName:"Book",render:function(){var a="/media/"+this.props.book.fields.picture;return React.createElement("div",{className:"col-sm-3 col-md-3"},React.createElement("div",{className:"book thumbnail",style:{textAlign:"center",border:"none"}},React.createElement("img",{src:a,style:{width:242,height:200}}),React.createElement("div",{className:"caption"},React.createElement("h3",null,this.props.book.fields.name),React.createElement("p",null,this.props.book.fields.author),React.createElement("p",null,React.createElement(ApplyButton,{book:this.props.book}),React.createElement(LikeButton,{book:this.props.book})))))}}),BookApplies=React.createClass({displayName:"BookApplies",getInitialState:function(){return{applies:[]}},componentDidMount:function(){this.loadDataFromServer()},loadDataFromServer:function(){var a=this.props.bookId,b="/drift/"+a+"/apply/get/";$.get(b,function(a){a=JSON.parse(a);var b=a.map(function(a){return{user:a.fields.user,time:a.fields.createTime}});this.setState({applies:b})}.bind(this))},render:function(){var a=this.state.applies.map(function(a){return React.createElement("span",{style:{margin:15}},React.createElement(UserAvatar,{userId:a.user}),React.createElement("br",null),React.createElement("span",null,a.time))});return React.createElement("div",{style:{display:"flex",alignItems:"center"}},React.createElement("h4",null,"申请者们："),a)}}),BookDetail=React.createClass({displayName:"BookDetail",render:function(){var a="/media/"+this.props.book.fields.picture;return React.createElement("div",{className:"container"},React.createElement("div",{className:"pull-left"},React.createElement("img",{src:a})),React.createElement("div",{className:"pull-left",style:{marginLeft:50,width:500}},React.createElement("p",null,"书名：",this.props.book.fields.name),React.createElement("p",null,"作者：",this.props.book.fields.author),React.createElement("p",null,"类型：",this.props.book.fields.kind),React.createElement("p",null,"拥有者：",React.createElement(UserAvatar,{userId:this.props.book.fields.originOwner})),React.createElement("p",null,"所在处：",React.createElement(UserAvatar,{userId:this.props.book.fields.currentOwner})),React.createElement("p",{style:{width:400}},React.createElement("h4",null,"简介："),React.createElement("span",{style:{width:400}},this.props.book.fields.description)),React.createElement("p",null,React.createElement(ApplyButton,{book:this.props.book}),React.createElement(LikeButton,{book:this.props.book}))),React.createElement("br",{style:{clear:"both"}}),React.createElement("hr",null),React.createElement(BookApplies,{bookId:this.props.book.pk}),React.createElement("hr",null),React.createElement(CommentList,{book:this.props.book}),React.createElement("hr",null),React.createElement(AddCommentForm,{book:this.props.book}))}}),BookList=React.createClass({displayName:"BookList",getInitialState:function(){return{books:[]}},componentDidMount:function(){this.loadDataFromServer()},loadDataFromServer:function(){var a=this.props.url;$.get(a,function(a){a=JSON.parse(a),this.setState({books:a})}.bind(this))},render:function(){console.log(this.state.books);for(var a=[],b=0;b<this.state.books.length;b++){var c=this.state.books[b];console.log(c),a.push(React.createElement(Book,{book:c}))}return React.createElement("div",{className:"bookList"},a)}}),BookRecord=React.createClass({displayName:"BookRecord",getInitialState:function(){return{nextApply:null}},componentDidMount:function(){this.loadDataFromServer()},loadDataFromServer:function(){var a=this.props.book.pk,b="/drift/"+a+"/next/get/";$.get(b,function(a){if(a=JSON.parse(a),a.length){var b=a[0];this.setState({nextApply:b})}}.bind(this))},getRightPart:function(){var a=this.state.nextApply;if(!a)return React.createElement("span",null,"暂无申请者");var b=a.fields.user;return React.createElement("span",null,React.createElement(UserAvatar,{userId:b}),React.createElement("span",{onClick:this.addDrift},"转给他"))},addDrift:function(){var a=this.state.nextApply,b=a.fields.user,c=this.props.book.pk,d="/drift/"+c+"/to/"+b+"/";$.get(d,function(a){"200"==a&&this.unmount()}.bind(this))},unmount:function(){var a=this.getDOMNode();React.unmountComponentAtNode(a),$(a).remove()},render:function(){var a="/media/"+this.props.book.fields.picture,b=this.getRightPart();return React.createElement("div",{className:"media",style:{borderTop:"solid 1px #ddd"}},React.createElement("div",{className:"media-left"},React.createElement("img",{className:"media-object",src:a})),React.createElement("div",{className:"media-body"},React.createElement("h4",{className:"media-heading"},this.props.book.fields.name),React.createElement("p",null,this.props.book.fields.author),React.createElement("span",{className:"pull-right"},b)))}}),BookRecordList=React.createClass({displayName:"BookRecordList",getInitialState:function(){return{books:[]}},componentDidMount:function(){this.loadDataFromServer()},loadDataFromServer:function(){var a=localStorage.userId,b="/book/of/"+a+"/";$.get(b,function(a){a=JSON.parse(a),this.setState({books:a})}.bind(this))},render:function(){var a=this.state.books.map(function(a){return React.createElement(BookRecord,{book:a})});return console.log(a),React.createElement("div",{className:"list container"},a)}}),Comment=React.createClass({displayName:"Comment",componentDidMount:function(){this.loadDataFromServer()},getInitialState:function(){return{userName:""}},loadDataFromServer:function(){var a=this.props.comment.fields.user,b="/user/"+a+"/get/";$.get(b,function(a){a=JSON.parse(a),name=a.fields.name,this.setState({userName:name})}.bind(this))},render:function(){"/user/"+this.props.comment.fields.user+"/avatar/get/";return React.createElement("div",{className:"media"},React.createElement("div",{className:"media-left"},React.createElement(UserAvatar,{userId:this.props.comment.fields.user})),React.createElement("div",{className:"media-body"},React.createElement("h4",{className:"media-heading"},this.state.userName),"评分：",this.props.comment.fields.mark," ",React.createElement("br",null),"内容：",this.props.comment.fields.content))}}),CommentList=React.createClass({displayName:"CommentList",getInitialState:function(){return{comments:[]}},loadDataFromServer:function(){var a=this.props.book.pk,b="/book/"+a+"/comment/all/";$.get(b,function(a){a=JSON.parse(a),this.setState({comments:a})}.bind(this))},componentDidMount:function(){this.loadDataFromServer()},render:function(){var a=this.state.comments.map(function(a){return React.createElement(Comment,{comment:a})});return React.createElement("div",{className:"commentList"},React.createElement("h4",null,"评论："),a)}}),DriftHistory=React.createClass({displayName:"DriftHistory",render:function(){return React.createElement("div",null)}}),LikeButton=React.createClass({displayName:"LikeButton",getInitialState:function(){return{like:0}},componentDidMount:function(){this.loadDataFromServer()},loadDataFromServer:function(){var a="/book/"+this.props.book.pk+"/like/get/number/";$.get(a,function(a){this.setState({like:a})}.bind(this))},addLike:function(){var a=localStorage.userId,b="/book/"+this.props.book.pk+"/like/by/"+a+"/";$.get(b,function(a){200==a&&this.loadDataFromServer()}.bind(this))},render:function(){return React.createElement("a",{href:"#",className:"btn btn-default",role:"button",onClick:this.addLike},React.createElement("span",{className:"glyphicon glyphicon-thumbs-up"},this.state.like))}}),LoginForm=React.createClass({displayName:"LoginForm",submit:function(a){a.preventDefault(),$.ajax({url:"/user/login/",type:"POST",data:new FormData(a.target),contentType:!1,processData:!1,success:function(a){a>0&&($("#loginForm input").val(""),localStorage.userId=a)}})},render:function(){return React.createElement("form",{className:"form-horizontal",id:"loginrForm",onSubmit:this.submit},React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputAccount",className:"col-sm-2 control-label"},"用户名"),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{type:"text",className:"form-control",id:"inputAccount",ref:"account",name:"account"}))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputPassword",className:"col-sm-2 control-label"},"密码"),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{type:"password",className:"form-control",id:"inputPassword",ref:"password",name:"password"}))),React.createElement("div",{className:"form-group"},React.createElement("div",{className:"col-sm-10 col-sm-offset-2"},React.createElement("input",{type:"submit",className:"form-control",value:"马上登录"}))))}}),RegisterForm=React.createClass({displayName:"RegisterForm",submit:function(a){a.preventDefault(),$.ajax({url:"/user/register/",type:"POST",data:new FormData(a.target),contentType:!1,processData:!1,success:function(a){alert(a),"200"==a&&$("#registerForm input").val("")}})},render:function(){return React.createElement("form",{className:"form-horizontal",id:"registerForm",onSubmit:this.submit},React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputAccount",className:"col-sm-2 control-label"},"用户名"),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{type:"text",className:"form-control",id:"inputAccount",ref:"account",name:"account"}))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputPassword",className:"col-sm-2 control-label"},"密码"),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{type:"password",className:"form-control",id:"inputPassword",ref:"password",name:"password"}))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputAvatar",className:"col-sm-2 control-label"},"头像"),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{type:"file",className:"form-control",id:"inputAvatar",ref:"avatar",name:"avatar"}))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputName",className:"col-sm-2 control-label"},"昵称"),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{type:"text",className:"form-control",id:"inputName",ref:"name",name:"name"}))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputPhone",className:"col-sm-2 control-label"},"电话"),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{type:"text",className:"form-control",id:"inputPhone",ref:"phone",name:"phone"}))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputAddress",className:"col-sm-2 control-label"},"地址"),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{type:"text",className:"form-control",id:"inputAddress",ref:"address",name:"address"}))),React.createElement("div",{className:"form-group"},React.createElement("div",{className:"col-sm-10 col-sm-offset-2"},React.createElement("input",{type:"submit",className:"form-control",value:"马上注册"}))))}}),UserAvatar=React.createClass({displayName:"UserAvatar",getInitialState:function(){return{user:null}},componentDidMount:function(){this.loadDataFromServer()},loadDataFromServer:function(){$.get("/user/"+this.props.userId+"/get/",function(a){a=JSON.parse(a),user=a[0],this.setState({user:user})}.bind(this))},render:function(){var a="/user/"+this.props.userId+"/avatar/get/",b=React.createElement("img",{style:{borderRadius:"50%",width:50,height:50,display:"inline-block"},src:a});if(!this.state.user)return b;var c=this.state.user.fields.name,d=this.state.user.fields.phone,e=this.state.user.fields.address,f=this.props.userId,g="userId_"+f;return React.createElement(ReactBootstrap.OverlayTrigger,{trigger:"hover",placement:"bottom",id:g,overlay:React.createElement(ReactBootstrap.Popover,{title:c},React.createElement("strong",null,"电话："),d,React.createElement("br",null),React.createElement("strong",null,"地址："),e)},b)}});